<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>📺 Mi TV Station</title>

  <!-- TailwindCSS CDN para estilo moderno -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>

    

    @keyframes marquee {
      0% { transform: translateX(100%) }
      100% { transform: translateX(-100%) }
    }
  
    @keyframes marquee2 {
      0% { transform: translateX(-100%) }
      100% { transform: translateX(100%) }
    }
    @keyframes marquee3 {
      0% { transform: translateX(100%) }
      100% { transform: translateX(-100%) }
     
    }
    
    .animate-marquee {
      animation: marquee 500s infinite;
      min-width: 300%;
    }
    .animate-marquee2 {
      animation: marquee2 500s linear infinite;
      min-width: 300%;
    }
    .animate-marquee3 {
      animation: marquee3 50s linear infinite;
      min-width: 300%;
    }
    
  </style>






  <!-- Configuración opcional de Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#111',
            dark: '#007BFF',
          },
        },
      },
    };
    
    
</script>

<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<style>
  .swiper-slide {
    background: #1f1f1f;
    color: #fff;
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    width: 280px !important;
  }

  .swiper-slide:hover {
    transform: scale(1.05);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
  }
</style>





</head>

<body class="bg-white text-gray-800 font-sans p-405 max-w-4xl mx-auto">

  <h1 class="text-4xl font-bold text-center mb-405">📺 Mi TV Station</h1>
  

  <!-- Video player -->
  <div id="botonFavoritos" class="mt-2 text-center"></div>
  <div class="mb-6 rounded-lg overflow-hidden shadow-lg">
    <video id="videoPlayer" class="w-full" controls autoplay></video>
  </div>


<!-- Carruseles debajo del video -->

<!-- Carrusel de canales dinámico -->
  <div id="carouselContainer" class="relative overflow-hidden bg-white text-black py-6 mb-6 rounded-lg shadow-inner group">

    <!-- Izquierda a derecha -->
    <div id="carouselLeft" class="absolute whitespace-nowrap animate-marquee text-sm text-black group-hover:[animation-play-state:paused] top-1.5"></div>
  
    
  </div>
                                                                                                                                                     
  

  
  

  <div id="carouselContainer" class="relative overflow-hidden bg-white text-black py-6 mb-6 rounded-lg shadow-inner group">

   
    
    <div id="carouselFavs" class="absolute whitespace-nowrap animate-marquee3 text-sm text-black group-hover:[animation-play-state:paused] top-1.5"></div>
  </div>
<!-- carrusel -->
<!-- Favorites -->
 
<div id="favoritesBar" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-6"></div>

  

  <!-- Search -->
  <input id="searchBox" class="w-full p-3 border border-gray-300 rounded-lg mb-4" placeholder="🔍 Buscar por nombre o categoría..." />

  <!-- Channel dropdown -->
  <select id="channelDropdown" multiple size="10" class="w-full p-3 border border-gray-300 rounded-lg mb-4"></select>





  <!-- Botones principales -->
  <div class="flex flex-wrap gap-3 mb-6">
    <button onclick="startRandomPreviewLoop()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">▶️ Auto Pilot</button>
    <button onclick="playSelectedChannel()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg">▶️ Ver canal seleccionado</button>
  </div>

  <!-- Playlist file -->
  <div class="flex items-center gap-3 mb-4">
    <input type="file" accept=".json" id="playlistFile" class="flex-1" />
    <button onclick="loadUploadedPlaylist()" class="bg-gray-700 hover:bg-gray-800 text-white px-3 py-2 rounded-lg">📂 Cargar Lista</button>
  </div>

  <!-- Playlist nombre y guardar -->
  <div class="flex items-center gap-3 mb-4">
    <input id="playlistName" placeholder="📝 Nombre de la playlist" class="flex-1 p-2 border border-gray-300 rounded-lg" />
    <button onclick="savePlaylist()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg">💾 Guardar</button>
  </div>

  
  <div id="carouselContainer" class="relative overflow-hidden bg-white text-black py-6 mb-6 rounded-lg shadow-inner group">

   
  
    <!-- Derecha a izquierda -->
    <div id="carouselRight" class="absolute whitespace-nowrap animate-marquee2 text-sm text-black group-hover:[animation-play-state:paused] top-1.5 left-0"></div>
    
   
  </div>


  <!-- Playlist guardadas -->
  <div class="flex flex-wrap items-center gap-3 mb-6">
    <select id="savedPlaylists" onchange="loadSavedPlaylist(this.value)" class="flex-1 p-2 border border-gray-300 rounded-lg">
      <option value="">📁 Selecciona una lista...</option>
    </select>
    <button onclick="deleteSelectedPlaylist()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg">🗑️ Eliminar</button>
    <button onclick="exportPlaylist()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg">⬇️ Exportar</button>
  </div>


  

  <!-- Editor -->
  <div id="channelEditorWrapper" class="mb-6">
    <button id="toggleEditorBtn" onclick="toggleEditor()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg">
      🎛️ Mostrar Editor de Canales
    </button>
    <div id="channelEditor" class="mt-4 hidden"></div>
  </div>


  <!-- Tu JS -->
  
  <script>

  

    const video = document.getElementById('videoPlayer');
    const dropdown = document.getElementById('channelDropdown');
    const savedPlaylistsDropdown = document.getElementById('savedPlaylists');
    const fileInput = document.getElementById('playlistFile');
    const favoritesBar = document.getElementById('favoritesBar');
    const channelEditor = document.getElementById('channelEditor');

    let playlist = [...Array(1000)].map((_, i) => ({
      name: `Canal ${i + 1}`,
      url: `https://vod.mycamtv.net/${i + 1}.m3u8`,
      category: `Categoria ${(i % 10) + 1}`
    }));

    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

    function loadUploadedPlaylist() {
      const file = fileInput.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          if (!Array.isArray(data)) throw new Error('Formato inválido');
          playlist = data.map(item => ({
            ...item,
            category: item.category || generateCategory(item.name)
          }));
          
          populateDropdown();
          actualizarCarruseles();

        } catch (err) {
          alert('Error al cargar la lista');
        }
      };
      reader.readAsText(file);
    }

    function toggleEditor() {
      channelEditor.classList.toggle('hidden');
      renderEditor();
    }

    function renderEditor() {
      channelEditor.innerHTML = '';
      playlist.forEach((channel, i) => {
        const div = document.createElement('div');
        div.className = 'flex flex-col sm:flex-row gap-2 mb-2';

        const inputName = document.createElement('input');
        inputName.value = channel.name;
        inputName.placeholder = 'Nombre';
        inputName.className = 'flex-1 p-2 border rounded';

        const inputURL = document.createElement('input');
        inputURL.value = channel.url;
        inputURL.placeholder = 'URL';
        inputURL.className = 'flex-1 p-2 border rounded';

        const inputCat = document.createElement('input');
        inputCat.value = channel.category || '';
        inputCat.placeholder = 'Categoría';
        inputCat.className = 'flex-1 p-2 border rounded';

        const saveBtn = document.createElement('button');
        saveBtn.textContent = '💾';
        saveBtn.className = 'px-3 py-2 bg-blue-500 text-white rounded';
        saveBtn.onclick = () => {
          playlist[i] = {
            name: inputName.value,
            url: inputURL.value,
            category: inputCat.value || generateCategory(inputName.value)
          };
          populateDropdown();
        };

        div.appendChild(inputName);
        div.appendChild(inputURL);
        div.appendChild(inputCat);
        div.appendChild(saveBtn);
        channelEditor.appendChild(div);
      });
    }

    function generateCategory(name) {
      const keywords = ['news', 'sports','show','comic','fun','kids','box','hits','music','movie','peru','weather','reality','cooking','fishing','history','españa','colombia','ecuador','pluto','retro','cars','auto','fm','radio','series'];
      const lowerName = name.toLowerCase();
      for (let keyword of keywords) {
        if (lowerName.includes(keyword)) return keyword;
      }
      return 'General';
    }

    function populateDropdown() {
      dropdown.innerHTML = '';
      for (const channel of playlist) {
        const option = document.createElement('option');
        option.value = channel.url;
        option.textContent = channel.name;
        dropdown.appendChild(option);

        option.addEventListener('click', () => {
          addToFavorites(channel);
          populateDropdown();
          verificarMostrarCarrusel();
        });
      }
      function marcarInternos() {
  playlist = playlist.map((item, index) => ({
    ...item,
    internal: item.url.includes("vod.mycamtv.net")
  }));
}

function actualizarCarruseles() {
  marcarInternos();
  crearCarruseles();
}

      renderFavorites();
    }

    function renderFavorites() {
      favoritesBar.innerHTML = '';
      favorites.forEach(channel => {
        const card = document.createElement('div');
        card.className = 'fav-card bg-white border p-3 rounded-lg shadow text-center';

        const img = document.createElement('img');
        img.src = 'https://via.placeholder.com/120x60?text=Canal';
        img.alt = channel.name;
        img.className = 'mx-auto mb-2';

        const name = document.createElement('div');
        name.textContent = channel.name;
        name.className = 'font-semibold';

        const playBtn = document.createElement('button');
        playBtn.textContent = '▶️';
        playBtn.className = 'mr-2 bg-green-500 text-white px-2 py-1 rounded';
        playBtn.onclick = () => {
          video.src = channel.url;
          video.play();
        };

        const removeBtn = document.createElement('button');
        removeBtn.textContent = '❌';
        removeBtn.className = 'bg-red-500 text-white px-2 py-1 rounded';
        removeBtn.onclick = () => {
          favorites = favorites.filter(f => f.url !== channel.url);
          localStorage.setItem('favorites', JSON.stringify(favorites));
          renderFavorites();
          actualizarCarruselDeFavoritos();  // ✅ también aquí
        };

        card.appendChild(img);
        card.appendChild(name);
        card.appendChild(playBtn);
        card.appendChild(removeBtn);
        favoritesBar.appendChild(card);
      });
    }

    function addToFavorites(channel) {
  if (!favorites.find(f => f.url === channel.url)) {
    favorites.push(channel);
    localStorage.setItem('favorites', JSON.stringify(favorites));
    renderFavorites();
    actualizarCarruselDeFavoritos(); // << actualiza carrusel de favoritos
    alert(`${channel.name} agregado a favoritos.`);
  }
}


    function playSelectedChannel() {
      const selected = dropdown.value;
      if (selected) {
        video.src = selected;
        video.play();
      }
    }

    function startRandomPreviewLoop() {
      const selectedOptions = Array.from(dropdown.selectedOptions);
      if (selectedOptions.length === 0) return alert('Selecciona uno o más canales.');
      let currentIndex = 0;

      function playNext() {
        if (stopRandomPreview) return;
        const current = selectedOptions[currentIndex];
        video.src = current.value;
        video.play();
        currentIndex = (currentIndex + 1) % selectedOptions.length;
        randomLoopTimeout = setTimeout(playNext, 60000);
      }

      stopRandomPreview = false;
      playNext();
    }

    let stopRandomPreview = false;
    function stopRandomPreviewLoop() {
      stopRandomPreview = true;
      clearTimeout(randomLoopTimeout);
      video.pause();
    }

    function savePlaylist() {
      const name = document.getElementById('playlistName').value.trim();
      if (!name) return alert('Escribe un nombre para la playlist');
      const selected = Array.from(dropdown.selectedOptions).map(option => ({
        name: option.text,
        url: option.value
      }));
      localStorage.setItem(`playlist-${name}`, JSON.stringify(selected));
      alert(`Playlist "${name}" guardada.`);
      loadSavedPlaylists();
      actualizarCarruseles();

    }

    function loadSavedPlaylists() {
      const keys = Object.keys(localStorage).filter(key => key.startsWith('playlist-'));
      savedPlaylistsDropdown.innerHTML = '<option value="">Selecciona una lista...</option>';
      keys.forEach(key => {
        const name = key.replace('playlist-', '');
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        savedPlaylistsDropdown.appendChild(option);
      });
    }

    function loadSavedPlaylist(name) {
      if (!name) return;
      const saved = JSON.parse(localStorage.getItem(`playlist-${name}`));
      if (!saved) return;
      playlist = saved;
      populateDropdown();
      actualizarCarruseles();

    }

    function deleteSelectedPlaylist() {
      const name = savedPlaylistsDropdown.value;
      if (!name) return alert('Selecciona una lista para eliminar.');
      localStorage.removeItem(`playlist-${name}`);
      loadSavedPlaylists();
      alert(`Playlist "${name}" eliminada.`);
    }

    function exportPlaylist() {
      const name = savedPlaylistsDropdown.value;
      if (!name) return alert('Selecciona una lista para exportar.');
      const saved = JSON.parse(localStorage.getItem(`playlist-${name}`));
      if (!saved) return alert('Error al obtener la lista.');
      const json = JSON.stringify(saved, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${name}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    loadSavedPlaylists();
    populateDropdown();

    function obtenerNombreInteligente(channel) {
  if (channel.name && channel.name.trim() !== '') {
    return channel.name.trim();
  }

  if (channel.category && channel.category.trim() !== '') {
    return channel.category.trim();
  }

  // Extraer del enlace .m3u8 o .ts
  try {
    const urlParts = channel.url.split('/');
    const lastPart = urlParts[urlParts.length - 1];
    const cleanName = lastPart.replace(/\.[^/.]+$/, ''); // quita extensión
    return decodeURIComponent(cleanName);
  } catch {
    return 'Canal Desconocido';
  }
}

function actualizarCarruselConCanales() {
  const left = document.getElementById('carouselLeft');
  const right = document.getElementById('carouselRight');

  if (!playlist || playlist.length === 0) {
    left.innerHTML = '';
    right.innerHTML = '';
    return;
  }

  // Generar spans clicables
  const maxCanales = 1000; // <-- Cambia este número a la cantidad que quieras mostrar
  const canalesParaMostrar = playlist.slice(0, maxCanales);
  const spans = playlist.map(channel => {
    const nombre = obtenerNombreInteligente(channel);
    return `<span class="cursor-pointer hover:underline mx-4" onclick="reproducirDesdeCarrusel('${encodeURIComponent(nombre)}')">✅ ${nombre}</span>`;
  });

  const contenidoHTML = spans.join('•');
  left.innerHTML = contenidoHTML;
  right.innerHTML = contenidoHTML;
}
function actualizarCarruselDeFavoritos() {
  const container = document.getElementById('carouselFavs');
  if (!container) return;

  if (!favorites || favorites.length === 0) {
    container.innerHTML = '';
    return;
  }

  const spans = favorites.map(channel => {
    const nombre = obtenerNombreInteligente(channel);
    return `<span class="cursor-pointer hover:underline mx-4 text-yellow-300" onclick="reproducirDesdeCarrusel('${encodeURIComponent(nombre)}')">⭐ ${nombre}</span>`;
  });

  container.innerHTML = spans.join('•');
}




function reproducirDesdeCarrusel(nombreCodificado) {
  const nombre = decodeURIComponent(nombreCodificado);

  const canal = playlist.find(channel => {
    const nombreInteligente = obtenerNombreInteligente(channel);
    return nombreInteligente === nombre;
  });

  if (!canal) {
    alert(`Canal "${nombre}" no encontrado`);
    return;
  }

  const video = document.getElementById('videoPlayer');
  video.src = canal.url;
  video.play();
}
// Mostrar u ocultar carrusel según conexión y datos cargados
function verificarMostrarCarrusel() {
  const online = navigator.onLine;
  const hayCanales = playlist && playlist.length > 0;

  const carousel = document.getElementById('carouselContainer');
  if (online && hayCanales) {
    carousel.classList.remove('hidden');
    actualizarCarruselConCanales();
  } else {
    carousel.classList.add('hidden');
  }
}

// Ejecutar al cargar
window.addEventListener('load', verificarMostrarCarrusel);
window.addEventListener('online', verificarMostrarCarrusel);
window.addEventListener('offline', verificarMostrarCarrusel);


  // Agregar botón para mostrar/ocultar carrusel de favoritos
  const botonFavoritos = document.getElementById("botonFavoritos");
  const carouselFavs = document.getElementById("carouselFavs");

  let favoritosVisibles = true;

  const toggleBtn = document.createElement("button");
  toggleBtn.className = "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg";
  toggleBtn.textContent = "🔁 Mostrar/Ocultar Favoritos";

  toggleBtn.onclick = () => {
    favoritosVisibles = !favoritosVisibles;
    carouselFavs.style.display = favoritosVisibles ? "block" : "none";
  };

  botonFavoritos.appendChild(toggleBtn);


  </script>
</body>
</html>

  <script src="main.js"></script>
</body>
</html>
